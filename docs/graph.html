---

title: Graph

keywords: fastai
sidebar: home_sidebar

summary: "Generate DAG graphs that abstract architectures of CNNs"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\02_graph.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ResNets">ResNets<a class="anchor-link" href="#ResNets">&#182;</a></h2><blockquote><p>The DAG graphs of ResNets.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastdot</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stage1</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="s1">&#39;stage1&#39;</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">stage1</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">Point</span><span class="p">())</span> 
<span class="n">node1</span> <span class="o">=</span> <span class="n">stage1</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;node1&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>
<span class="n">node2</span> <span class="o">=</span> <span class="n">stage1</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;node2&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>
<span class="n">node3</span> <span class="o">=</span> <span class="n">stage1</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;node3&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>
<span class="n">stage1</span><span class="o">.</span><span class="n">add_items</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node1</span><span class="p">),</span><span class="n">start</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node2</span><span class="p">),</span><span class="n">start</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node3</span><span class="p">),</span>
                 <span class="n">node1</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node2</span><span class="p">),</span><span class="n">node1</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node3</span><span class="p">),</span>
                 <span class="n">node2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node3</span><span class="p">),</span>
                <span class="p">)</span>

<span class="n">stage2</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="s1">&#39;stage2&#39;</span><span class="p">)</span>
<span class="n">node4</span> <span class="o">=</span> <span class="n">stage2</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;node4&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">)</span>
<span class="n">node5</span> <span class="o">=</span> <span class="n">stage2</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;node5&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>
<span class="n">node6</span> <span class="o">=</span> <span class="n">stage2</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;node6&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>
<span class="n">idmap</span> <span class="o">=</span> <span class="n">stage2</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;idmap&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">stage2</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">stage2</span><span class="o">.</span><span class="n">add_items</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node4</span><span class="p">),</span><span class="n">node1</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node4</span><span class="p">),</span><span class="n">node2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node4</span><span class="p">),</span><span class="n">node3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node4</span><span class="p">),</span>
                 <span class="n">start</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">idmap</span><span class="p">),</span><span class="n">node1</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">idmap</span><span class="p">),</span><span class="n">node2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">idmap</span><span class="p">),</span><span class="n">node3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">idmap</span><span class="p">),</span>
                 <span class="n">node4</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node5</span><span class="p">),</span><span class="n">node4</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node6</span><span class="p">),</span><span class="n">node4</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">end</span><span class="p">),</span>
                 <span class="n">idmap</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node5</span><span class="p">),</span><span class="n">idmap</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node6</span><span class="p">),</span><span class="n">idmap</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">end</span><span class="p">),</span>
                 <span class="n">node5</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node6</span><span class="p">),</span><span class="n">node5</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">end</span><span class="p">),</span>
                 <span class="n">node6</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
                <span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">stage1</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">stage2</span><span class="p">)</span>
<span class="n">g</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: G Pages: 1 -->
<svg width="674pt" height="260pt"
 viewBox="0.00 0.00 673.60 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-256 669.6,-256 669.6,4 -4,4"/>
<g id="clust1" class="cluster"><title>cluster_n30c003dd2ec8425d93d83e95147d4098</title>
<g id="a_clust1"><a xlink:title="stage1">
<path fill="#555555" fill-opacity="0.133333" stroke="black" d="M20,-129C20,-129 285.6,-129 285.6,-129 291.6,-129 297.6,-135 297.6,-141 297.6,-141 297.6,-232 297.6,-232 297.6,-238 291.6,-244 285.6,-244 285.6,-244 20,-244 20,-244 14,-244 8,-238 8,-232 8,-232 8,-141 8,-141 8,-135 14,-129 20,-129"/>
<text text-anchor="middle" x="152.8" y="-228.8" font-family="Times New Roman,serif" font-size="14.00">stage1</text>
</a>
</g>
</g>
<g id="clust2" class="cluster"><title>cluster_nc0b501dc6b0a4369a9051413a8bed0bd</title>
<g id="a_clust2"><a xlink:title="stage2">
<path fill="#555555" fill-opacity="0.133333" stroke="black" d="M329.6,-8C329.6,-8 645.6,-8 645.6,-8 651.6,-8 657.6,-14 657.6,-20 657.6,-20 657.6,-151 657.6,-151 657.6,-157 651.6,-163 645.6,-163 645.6,-163 329.6,-163 329.6,-163 323.6,-163 317.6,-157 317.6,-151 317.6,-151 317.6,-20 317.6,-20 317.6,-14 323.6,-8 329.6,-8"/>
<text text-anchor="middle" x="487.6" y="-147.8" font-family="Times New Roman,serif" font-size="14.00">stage2</text>
</a>
</g>
</g>
<!-- na759d4453dbb492db97a669e194f6bbc -->
<g id="node1" class="node"><title>na759d4453dbb492db97a669e194f6bbc</title>
<g id="a_node1"><a xlink:title="pnt">
<ellipse fill="#62fbc4" fill-opacity="0.294118" stroke="black" cx="17.8" cy="-155" rx="1.8" ry="1.8"/>
</a>
</g>
</g>
<!-- nd375e7febc7848ada422a0d78b0ad281 -->
<g id="node2" class="node"><title>nd375e7febc7848ada422a0d78b0ad281</title>
<g id="a_node2"><a xlink:title="node1">
<path fill="lightblue" stroke="black" d="M97.6,-173C97.6,-173 67.6,-173 67.6,-173 61.6,-173 55.6,-167 55.6,-161 55.6,-161 55.6,-149 55.6,-149 55.6,-143 61.6,-137 67.6,-137 67.6,-137 97.6,-137 97.6,-137 103.6,-137 109.6,-143 109.6,-149 109.6,-149 109.6,-161 109.6,-161 109.6,-167 103.6,-173 97.6,-173"/>
<text text-anchor="middle" x="82.6" y="-151.3" font-family="Times New Roman,serif" font-size="14.00">node1</text>
</a>
</g>
</g>
<!-- na759d4453dbb492db97a669e194f6bbc&#45;&gt;nd375e7febc7848ada422a0d78b0ad281 -->
<g id="edge1" class="edge"><title>na759d4453dbb492db97a669e194f6bbc&#45;&gt;nd375e7febc7848ada422a0d78b0ad281</title>
<path fill="none" stroke="black" d="M19.89,-155C23.2409,-155 33.8628,-155 45.3712,-155"/>
<polygon fill="black" stroke="black" points="45.5525,-158.5 55.5525,-155 45.5524,-151.5 45.5525,-158.5"/>
</g>
<!-- n7e980e88d92949edb850543c0ed1f01f -->
<g id="node3" class="node"><title>n7e980e88d92949edb850543c0ed1f01f</title>
<g id="a_node3"><a xlink:title="node2">
<path fill="lightblue" stroke="black" d="M187.6,-173C187.6,-173 157.6,-173 157.6,-173 151.6,-173 145.6,-167 145.6,-161 145.6,-161 145.6,-149 145.6,-149 145.6,-143 151.6,-137 157.6,-137 157.6,-137 187.6,-137 187.6,-137 193.6,-137 199.6,-143 199.6,-149 199.6,-149 199.6,-161 199.6,-161 199.6,-167 193.6,-173 187.6,-173"/>
<text text-anchor="middle" x="172.6" y="-151.3" font-family="Times New Roman,serif" font-size="14.00">node2</text>
</a>
</g>
</g>
<!-- na759d4453dbb492db97a669e194f6bbc&#45;&gt;n7e980e88d92949edb850543c0ed1f01f -->
<g id="edge2" class="edge"><title>na759d4453dbb492db97a669e194f6bbc&#45;&gt;n7e980e88d92949edb850543c0ed1f01f</title>
<path fill="none" stroke="black" d="M19.5905,-155.901C23.2079,-159.947 38.7317,-176.476 55.6,-182 78.408,-189.47 86.1043,-186.894 109.6,-182 118.535,-180.139 127.761,-176.918 136.278,-173.335"/>
<polygon fill="black" stroke="black" points="137.841,-176.47 145.538,-169.189 134.981,-170.081 137.841,-176.47"/>
</g>
<!-- n9d1e78a4439d4e5ba90e829b2f2c997e -->
<g id="node4" class="node"><title>n9d1e78a4439d4e5ba90e829b2f2c997e</title>
<g id="a_node4"><a xlink:title="node3">
<path fill="lightblue" stroke="black" d="M277.6,-213C277.6,-213 247.6,-213 247.6,-213 241.6,-213 235.6,-207 235.6,-201 235.6,-201 235.6,-189 235.6,-189 235.6,-183 241.6,-177 247.6,-177 247.6,-177 277.6,-177 277.6,-177 283.6,-177 289.6,-183 289.6,-189 289.6,-189 289.6,-201 289.6,-201 289.6,-207 283.6,-213 277.6,-213"/>
<text text-anchor="middle" x="262.6" y="-191.3" font-family="Times New Roman,serif" font-size="14.00">node3</text>
</a>
</g>
</g>
<!-- na759d4453dbb492db97a669e194f6bbc&#45;&gt;n9d1e78a4439d4e5ba90e829b2f2c997e -->
<g id="edge3" class="edge"><title>na759d4453dbb492db97a669e194f6bbc&#45;&gt;n9d1e78a4439d4e5ba90e829b2f2c997e</title>
<path fill="none" stroke="black" d="M19.5356,-156.116C22.9151,-161.128 37.5604,-181.638 55.6,-189 111.332,-211.746 182.783,-207.186 225.221,-201.387"/>
<polygon fill="black" stroke="black" points="225.971,-204.815 235.358,-199.902 224.957,-197.889 225.971,-204.815"/>
</g>
<!-- n0d947899340d443b8709e9c298b50b72 -->
<g id="node5" class="node"><title>n0d947899340d443b8709e9c298b50b72</title>
<g id="a_node5"><a xlink:title="node4">
<path fill="pink" stroke="black" d="M367.6,-129C367.6,-129 337.6,-129 337.6,-129 331.6,-129 325.6,-123 325.6,-117 325.6,-117 325.6,-105 325.6,-105 325.6,-99 331.6,-93 337.6,-93 337.6,-93 367.6,-93 367.6,-93 373.6,-93 379.6,-99 379.6,-105 379.6,-105 379.6,-117 379.6,-117 379.6,-123 373.6,-129 367.6,-129"/>
<text text-anchor="middle" x="352.6" y="-107.3" font-family="Times New Roman,serif" font-size="14.00">node4</text>
</a>
</g>
</g>
<!-- na759d4453dbb492db97a669e194f6bbc&#45;&gt;n0d947899340d443b8709e9c298b50b72 -->
<g id="edge7" class="edge"><title>na759d4453dbb492db97a669e194f6bbc&#45;&gt;n0d947899340d443b8709e9c298b50b72</title>
<path fill="none" stroke="black" d="M19.6111,-154.155C23.3177,-150.352 39.171,-134.719 55.6,-128 155.526,-87.1329 189.714,-103.01 297.6,-107 303.295,-107.211 309.322,-107.546 315.203,-107.935"/>
<polygon fill="black" stroke="black" points="315.303,-111.451 325.529,-108.678 315.806,-104.469 315.303,-111.451"/>
</g>
<!-- n6b8c06b7e6d64d7e9193689071448af9 -->
<g id="node8" class="node"><title>n6b8c06b7e6d64d7e9193689071448af9</title>
<g id="a_node8"><a xlink:title="idmap">
<path fill="pink" stroke="black" d="M367.6,-55C367.6,-55 337.6,-55 337.6,-55 331.6,-55 325.6,-49 325.6,-43 325.6,-43 325.6,-31 325.6,-31 325.6,-25 331.6,-19 337.6,-19 337.6,-19 367.6,-19 367.6,-19 373.6,-19 379.6,-25 379.6,-31 379.6,-31 379.6,-43 379.6,-43 379.6,-49 373.6,-55 367.6,-55"/>
<text text-anchor="middle" x="352.6" y="-33.3" font-family="Times New Roman,serif" font-size="14.00">idmap</text>
</a>
</g>
</g>
<!-- na759d4453dbb492db97a669e194f6bbc&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9 -->
<g id="edge11" class="edge"><title>na759d4453dbb492db97a669e194f6bbc&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9</title>
<path fill="none" stroke="black" d="M19.4667,-153.536C22.5472,-146.936 36.0887,-119.683 55.6,-106 135.887,-49.6951 255.597,-38.776 315.181,-37.02"/>
<polygon fill="black" stroke="black" points="315.323,-40.5178 325.242,-36.7949 315.166,-33.5195 315.323,-40.5178"/>
</g>
<!-- nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n7e980e88d92949edb850543c0ed1f01f -->
<g id="edge4" class="edge"><title>nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n7e980e88d92949edb850543c0ed1f01f</title>
<path fill="none" stroke="black" d="M110.003,-155C117.993,-155 126.911,-155 135.424,-155"/>
<polygon fill="black" stroke="black" points="135.519,-158.5 145.519,-155 135.519,-151.5 135.519,-158.5"/>
</g>
<!-- nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n9d1e78a4439d4e5ba90e829b2f2c997e -->
<g id="edge5" class="edge"><title>nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n9d1e78a4439d4e5ba90e829b2f2c997e</title>
<path fill="none" stroke="black" d="M109.827,-168.496C120.642,-173.507 133.464,-178.756 145.6,-182 171.746,-188.988 202.18,-192.223 225.314,-193.719"/>
<polygon fill="black" stroke="black" points="225.205,-197.218 235.388,-194.291 225.603,-190.229 225.205,-197.218"/>
</g>
<!-- nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n0d947899340d443b8709e9c298b50b72 -->
<g id="edge8" class="edge"><title>nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n0d947899340d443b8709e9c298b50b72</title>
<path fill="none" stroke="black" d="M109.78,-141.323C120.588,-136.285 133.418,-131.066 145.6,-128 203.705,-113.378 273.645,-110.598 315.265,-110.433"/>
<polygon fill="black" stroke="black" points="315.46,-113.933 325.464,-110.443 315.467,-106.933 315.46,-113.933"/>
</g>
<!-- nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9 -->
<g id="edge12" class="edge"><title>nd375e7febc7848ada422a0d78b0ad281&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9</title>
<path fill="none" stroke="black" d="M109.122,-136.803C120.045,-129.477 133.135,-121.292 145.6,-115 203,-86.0257 273.863,-61.4646 315.743,-48.0182"/>
<polygon fill="black" stroke="black" points="317.017,-51.286 325.488,-44.9226 314.897,-44.6146 317.017,-51.286"/>
</g>
<!-- n7e980e88d92949edb850543c0ed1f01f&#45;&gt;n9d1e78a4439d4e5ba90e829b2f2c997e -->
<g id="edge6" class="edge"><title>n7e980e88d92949edb850543c0ed1f01f&#45;&gt;n9d1e78a4439d4e5ba90e829b2f2c997e</title>
<path fill="none" stroke="black" d="M200.003,-167.001C208.257,-170.753 217.5,-174.954 226.265,-178.939"/>
<polygon fill="black" stroke="black" points="224.967,-182.193 235.519,-183.145 227.864,-175.821 224.967,-182.193"/>
</g>
<!-- n7e980e88d92949edb850543c0ed1f01f&#45;&gt;n0d947899340d443b8709e9c298b50b72 -->
<g id="edge9" class="edge"><title>n7e980e88d92949edb850543c0ed1f01f&#45;&gt;n0d947899340d443b8709e9c298b50b72</title>
<path fill="none" stroke="black" d="M199.757,-148.803C224.873,-142.821 263.869,-133.452 297.6,-125 303.438,-123.537 309.623,-121.96 315.644,-120.409"/>
<polygon fill="black" stroke="black" points="316.725,-123.745 325.529,-117.851 314.971,-116.968 316.725,-123.745"/>
</g>
<!-- n7e980e88d92949edb850543c0ed1f01f&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9 -->
<g id="edge13" class="edge"><title>n7e980e88d92949edb850543c0ed1f01f&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9</title>
<path fill="none" stroke="black" d="M199.865,-137.589C230.846,-117.05 282.465,-82.8309 316.765,-60.0932"/>
<polygon fill="black" stroke="black" points="319.117,-62.7331 325.518,-54.2905 315.249,-56.8987 319.117,-62.7331"/>
</g>
<!-- n9d1e78a4439d4e5ba90e829b2f2c997e&#45;&gt;n0d947899340d443b8709e9c298b50b72 -->
<g id="edge10" class="edge"><title>n9d1e78a4439d4e5ba90e829b2f2c997e&#45;&gt;n0d947899340d443b8709e9c298b50b72</title>
<path fill="none" stroke="black" d="M283.054,-176.762C287.822,-172.273 292.903,-167.471 297.6,-163 306.641,-154.393 316.486,-144.937 325.265,-136.476"/>
<polygon fill="black" stroke="black" points="327.892,-138.805 332.658,-129.343 323.031,-133.768 327.892,-138.805"/>
</g>
<!-- n9d1e78a4439d4e5ba90e829b2f2c997e&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9 -->
<g id="edge14" class="edge"><title>n9d1e78a4439d4e5ba90e829b2f2c997e&#45;&gt;n6b8c06b7e6d64d7e9193689071448af9</title>
<path fill="none" stroke="black" d="M272.452,-176.779C287.686,-145.425 317.273,-84.5458 317.6,-84 321.655,-77.2281 326.414,-70.1974 331.065,-63.701"/>
<polygon fill="black" stroke="black" points="334.173,-65.3815 337.266,-55.2481 328.529,-61.2411 334.173,-65.3815"/>
</g>
<!-- n4b014139fbd24d54b01561d84f57d276 -->
<g id="node6" class="node"><title>n4b014139fbd24d54b01561d84f57d276</title>
<g id="a_node6"><a xlink:title="node5">
<path fill="lightblue" stroke="black" d="M457.6,-92C457.6,-92 427.6,-92 427.6,-92 421.6,-92 415.6,-86 415.6,-80 415.6,-80 415.6,-68 415.6,-68 415.6,-62 421.6,-56 427.6,-56 427.6,-56 457.6,-56 457.6,-56 463.6,-56 469.6,-62 469.6,-68 469.6,-68 469.6,-80 469.6,-80 469.6,-86 463.6,-92 457.6,-92"/>
<text text-anchor="middle" x="442.6" y="-70.3" font-family="Times New Roman,serif" font-size="14.00">node5</text>
</a>
</g>
</g>
<!-- n0d947899340d443b8709e9c298b50b72&#45;&gt;n4b014139fbd24d54b01561d84f57d276 -->
<g id="edge15" class="edge"><title>n0d947899340d443b8709e9c298b50b72&#45;&gt;n4b014139fbd24d54b01561d84f57d276</title>
<path fill="none" stroke="black" d="M380.003,-99.8988C388.257,-96.4284 397.5,-92.5422 406.265,-88.8569"/>
<polygon fill="black" stroke="black" points="407.657,-92.0682 415.519,-84.9659 404.944,-85.6154 407.657,-92.0682"/>
</g>
<!-- na5101e54b6a24433957a8e1564241218 -->
<g id="node7" class="node"><title>na5101e54b6a24433957a8e1564241218</title>
<g id="a_node7"><a xlink:title="node6">
<path fill="lightblue" stroke="black" d="M547.6,-82C547.6,-82 517.6,-82 517.6,-82 511.6,-82 505.6,-76 505.6,-70 505.6,-70 505.6,-58 505.6,-58 505.6,-52 511.6,-46 517.6,-46 517.6,-46 547.6,-46 547.6,-46 553.6,-46 559.6,-52 559.6,-58 559.6,-58 559.6,-70 559.6,-70 559.6,-76 553.6,-82 547.6,-82"/>
<text text-anchor="middle" x="532.6" y="-60.3" font-family="Times New Roman,serif" font-size="14.00">node6</text>
</a>
</g>
</g>
<!-- n0d947899340d443b8709e9c298b50b72&#45;&gt;na5101e54b6a24433957a8e1564241218 -->
<g id="edge16" class="edge"><title>n0d947899340d443b8709e9c298b50b72&#45;&gt;na5101e54b6a24433957a8e1564241218</title>
<path fill="none" stroke="black" d="M380.062,-112.054C404.014,-112.234 439.974,-110.556 469.6,-101 479.531,-97.7966 489.56,-92.7638 498.573,-87.4302"/>
<polygon fill="black" stroke="black" points="500.568,-90.311 507.205,-82.053 496.867,-84.3694 500.568,-90.311"/>
</g>
<!-- n24dc9da4b6ad4409b855bf673a106e4b -->
<g id="node9" class="node"><title>n24dc9da4b6ad4409b855bf673a106e4b</title>
<g id="a_node9"><a xlink:title="end">
<path fill="gray" stroke="black" d="M637.6,-100C637.6,-100 607.6,-100 607.6,-100 601.6,-100 595.6,-94 595.6,-88 595.6,-88 595.6,-76 595.6,-76 595.6,-70 601.6,-64 607.6,-64 607.6,-64 637.6,-64 637.6,-64 643.6,-64 649.6,-70 649.6,-76 649.6,-76 649.6,-88 649.6,-88 649.6,-94 643.6,-100 637.6,-100"/>
<text text-anchor="middle" x="622.6" y="-78.3" font-family="Times New Roman,serif" font-size="14.00">end</text>
</a>
</g>
</g>
<!-- n0d947899340d443b8709e9c298b50b72&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b -->
<g id="edge17" class="edge"><title>n0d947899340d443b8709e9c298b50b72&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b</title>
<path fill="none" stroke="black" d="M379.905,-112.153C403.445,-112.911 438.879,-113.375 469.6,-111 509.961,-107.88 519.893,-104.877 559.6,-97 568.018,-95.33 577.02,-93.2966 585.482,-91.2728"/>
<polygon fill="black" stroke="black" points="586.578,-94.6083 595.461,-88.8341 584.916,-87.8084 586.578,-94.6083"/>
</g>
<!-- n4b014139fbd24d54b01561d84f57d276&#45;&gt;na5101e54b6a24433957a8e1564241218 -->
<g id="edge21" class="edge"><title>n4b014139fbd24d54b01561d84f57d276&#45;&gt;na5101e54b6a24433957a8e1564241218</title>
<path fill="none" stroke="black" d="M470.003,-70.9997C477.993,-70.0917 486.911,-69.0783 495.424,-68.1109"/>
<polygon fill="black" stroke="black" points="495.978,-71.5706 505.519,-66.9638 495.188,-64.6153 495.978,-71.5706"/>
</g>
<!-- n4b014139fbd24d54b01561d84f57d276&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b -->
<g id="edge22" class="edge"><title>n4b014139fbd24d54b01561d84f57d276&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b</title>
<path fill="none" stroke="black" d="M469.828,-82.8635C480.752,-86.115 493.654,-89.3919 505.6,-91 532.161,-94.5754 562.349,-92.0272 585.27,-88.7424"/>
<polygon fill="black" stroke="black" points="585.902,-92.1863 595.251,-87.2007 584.834,-85.2684 585.902,-92.1863"/>
</g>
<!-- na5101e54b6a24433957a8e1564241218&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b -->
<g id="edge23" class="edge"><title>na5101e54b6a24433957a8e1564241218&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b</title>
<path fill="none" stroke="black" d="M560.003,-69.4006C568.081,-71.0529 577.107,-72.8991 585.705,-74.6578"/>
<polygon fill="black" stroke="black" points="585.02,-78.0902 595.519,-76.6652 586.423,-71.2322 585.02,-78.0902"/>
</g>
<!-- n6b8c06b7e6d64d7e9193689071448af9&#45;&gt;n4b014139fbd24d54b01561d84f57d276 -->
<g id="edge18" class="edge"><title>n6b8c06b7e6d64d7e9193689071448af9&#45;&gt;n4b014139fbd24d54b01561d84f57d276</title>
<path fill="none" stroke="black" d="M380.003,-48.1012C388.257,-51.5716 397.5,-55.4578 406.265,-59.1431"/>
<polygon fill="black" stroke="black" points="404.944,-62.3846 415.519,-63.0341 407.657,-55.9318 404.944,-62.3846"/>
</g>
<!-- n6b8c06b7e6d64d7e9193689071448af9&#45;&gt;na5101e54b6a24433957a8e1564241218 -->
<g id="edge19" class="edge"><title>n6b8c06b7e6d64d7e9193689071448af9&#45;&gt;na5101e54b6a24433957a8e1564241218</title>
<path fill="none" stroke="black" d="M380.039,-37.9121C403.667,-39.0509 439.155,-41.5604 469.6,-47 478.208,-48.538 487.354,-50.7267 495.902,-53.0239"/>
<polygon fill="black" stroke="black" points="495.021,-56.4119 505.595,-55.7379 496.909,-49.6711 495.021,-56.4119"/>
</g>
<!-- n6b8c06b7e6d64d7e9193689071448af9&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b -->
<g id="edge20" class="edge"><title>n6b8c06b7e6d64d7e9193689071448af9&#45;&gt;n24dc9da4b6ad4409b855bf673a106e4b</title>
<path fill="none" stroke="black" d="M379.768,-31.9617C419.69,-25.3802 497.691,-16.9009 559.6,-37 572.576,-41.2128 585.108,-49.2746 595.468,-57.4244"/>
<polygon fill="black" stroke="black" points="593.348,-60.2133 603.278,-63.9074 597.819,-54.8272 593.348,-60.2133"/>
</g>
</g>
</svg>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="resnet_dag" class="doc_header"><code>resnet_dag</code><a href="https://github.com/keepsimpler/wong/tree/master/wong/graph.py#L9" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>resnet_dag</code>(<strong><code>num_nodes</code></strong>:<code>tuple</code>)</p>
</blockquote>
<p>Generate the DAG corresponding to the architecture of ResNet. Input is numbers of nodes of all stages.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>an unique <code>input</code> node is added as the first node which connected to all other nodes of the first stage.</li>
<li>an <code>idmap</code> node is added as the first node for each stage except the first stage, which down-sample images of previous stage.</li>
<li>the second node of every stage except the first stage will halve the resolution of images of previous stage.</li>
<li>an unique <code>output</code> node is added as the last node of the last stage, which is connected to all other nodes of the last stage.
{% include note.html content="Constraint: <strong>the number of stages MUST BE 4 now</strong>, should be changed later." %}</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resnet50</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">resnet_dag</span><span class="p">(</span><span class="n">resnet50</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(NodeDataView({0: {&#39;stage&#39;: 0, &#39;optype&#39;: &#39;input&#39;}, 1: {&#39;stage&#39;: 0, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 2: {&#39;stage&#39;: 0, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 3: {&#39;stage&#39;: 0, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 4: {&#39;stage&#39;: 1, &#39;optype&#39;: &#39;idmap&#39;}, 5: {&#39;stage&#39;: 1, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 6: {&#39;stage&#39;: 1, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 7: {&#39;stage&#39;: 1, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 8: {&#39;stage&#39;: 1, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 9: {&#39;stage&#39;: 2, &#39;optype&#39;: &#39;idmap&#39;}, 10: {&#39;stage&#39;: 2, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 11: {&#39;stage&#39;: 2, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 12: {&#39;stage&#39;: 2, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 13: {&#39;stage&#39;: 2, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 14: {&#39;stage&#39;: 2, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 15: {&#39;stage&#39;: 2, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 16: {&#39;stage&#39;: 3, &#39;optype&#39;: &#39;idmap&#39;}, 17: {&#39;stage&#39;: 3, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 18: {&#39;stage&#39;: 3, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 19: {&#39;stage&#39;: 3, &#39;optype&#39;: &#39;resnet_bottleneck&#39;}, 20: {&#39;stage&#39;: 3, &#39;optype&#39;: &#39;output&#39;}}),
 OutEdgeView([(0, 1), (0, 2), (0, 3), (0, 4), (0, 5), (1, 2), (1, 3), (1, 4), (1, 5), (2, 3), (2, 4), (2, 5), (3, 4), (3, 5), (4, 6), (4, 7), (4, 8), (4, 9), (4, 10), (5, 6), (5, 7), (5, 8), (5, 9), (5, 10), (6, 7), (6, 8), (6, 9), (6, 10), (7, 8), (7, 9), (7, 10), (8, 9), (8, 10), (9, 11), (9, 12), (9, 13), (9, 14), (9, 15), (9, 16), (9, 17), (10, 11), (10, 12), (10, 13), (10, 14), (10, 15), (10, 16), (10, 17), (11, 12), (11, 13), (11, 14), (11, 15), (11, 16), (11, 17), (12, 13), (12, 14), (12, 15), (12, 16), (12, 17), (13, 14), (13, 15), (13, 16), (13, 17), (14, 15), (14, 16), (14, 17), (15, 16), (15, 17), (16, 18), (16, 19), (16, 20), (17, 18), (17, 19), (17, 20), (18, 19), (18, 20), (19, 20)]))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The DAG only have one type of nodes, the operation node. We could add a new type of node, the aggregate node, or memory node, that will cache the previous data in order to be used by following operation nodes. In order to generate such memory nodes, we need traverse the DAG from behind to start.</p>
<p>Suppose the DAG have $n$ nodes, then:</p>
<ol>
<li>Choose the last node $n-1$ as the current node, the second last node $n-2$ as the previous node.</li>
<li>Compare the sets of input nodes of the current node and the previous node, the intersection of two sets are the nodes that input to both the current node and the previous node, the complement set A are the nodes that input into the current node but not into the previous node,</li>
<li>A new memory node is inserted to graph. rewiring the intersection to the new memory node, and let the new node connected to both the previous node and the current node.</li>
<li></li>
</ol>

</div>
</div>
</div>
</div>
 

